void 0===Craft.ImageResizer&&(Craft.ImageResizer={}),function($){Craft.TabsManager=Garnish.Base.extend({init:function(){this.$selectedTab=null;for(var e=$("#settings-tabs").find("> ul > li > a"),t=0;t<e.length;t++){var s=$(e[t]),i=s.attr("href");i&&"#"===i.charAt(0)&&this.addListener(s,"click",(function(e){e.preventDefault(),this.selectTab(e.currentTarget)})),!this.$selectedTab&&s.hasClass("sel")&&(this.$selectedTab=s)}},selectTab:function(e){var t=$(e);if(this.$selectedTab){if(this.$selectedTab.get(0)===t.get(0))return;this.deselectTab()}t.addClass("sel"),$(t.attr("href")).removeClass("hidden"),Garnish.$win.trigger("resize"),Garnish.$doc.trigger("scroll"),this.$selectedTab=t},deselectTab:function(){this.$selectedTab&&(this.$selectedTab.removeClass("sel"),"#"===this.$selectedTab.attr("href").charAt(0)&&$(this.$selectedTab.attr("href")).addClass("hidden"),this.$selectedTab=null)}})}(jQuery),void 0===Craft.ImageResizer&&(Craft.ImageResizer={}),function($){Craft.ImageResizer.ResizeElementAction=Garnish.Base.extend({init:function(e,t,s){var i={width:e,height:t},a=new Craft.ElementActionTrigger({type:s,batch:!0,validateSelection:function(e){var t;return!(e.find(".element.hasicon").length>0)},activate:function(e){new Craft.ImageResizer.ResizeModal(e.find(".element"),e,i)}})}}),Craft.ImageResizer.BulkResizeAssetFolder=Garnish.Base.extend({init:function(e,t){var s={width:e,height:t};$(".bulk-resize-btn").on("click",(function(){s.assetFolderId=$(this).data("id"),s.assetFolderName=$(this).data("name"),s.bulkResize=!0,new Craft.ImageResizer.ResizeModal("","",s)}))}}),Craft.ImageResizer.ResizeModal=Garnish.Modal.extend({$element:null,$selectedItems:null,settings:null,$container:null,$footer:null,$body:null,$buttons:null,$closeBtn:null,$cancelBtn:null,$saveBtn:null,$footerSpinner:null,init:function(e,t,s){this.$element=e,this.$selectedItems=t,this.settings=s,this.desiredWidth="450",this.desiredHeight="340";var i=1==t.length?"":"s";if(this.$container=$('<div class="modal fitted image-resizer-modal"></div>').appendTo(Garnish.$bod),this.$footer=$('<div class="footer"/>').appendTo(this.$container),s.bulkResize)var a="<strong>all images in "+s.assetFolderName+"</strong>";else var a="<strong>"+t.length+"</strong> image"+i;var n='<div class="body"><div class="modal-content"><div class="modal-main"><div class="modal-elements"><h1>'+Craft.t("image-resizer","Resize Images")+"</h1><p>"+Craft.t("image-resizer","You are about to resize {desc} to be a maximum of {width}px wide and {height}px high. Alternatively, set the width and height limits below for on-demand resizing.",{desc:a,width:s.width,height:s.height})+'</p><input class="text" type="text" id="settings-imageWidth" size="10" name="settings[imageWidth]" value="'+s.width+'" autocomplete="off"> '+Craft.t("image-resizer","width")+' &nbsp;&nbsp;<input class="text" type="text" id="settings-imageHeight" size="10" name="settings[imageHeight]" value="'+s.height+'" autocomplete="off"> '+Craft.t("image-resizer","height")+"<p><strong>"+Craft.t("image-resizer","Caution")+":</strong> "+Craft.t("image-resizer","This operation permanently alters your images.")+"</p></div></div></div></div>",r=$(n).appendTo(this.$container);this.base(this.$container,this.settings),this.$footerSpinner=$('<div class="spinner hidden"/>').appendTo(this.$footer),this.$buttons=$('<div class="buttons rightalign first"/>').appendTo(this.$footer),this.$closeBtn=$('<div class="btn close hidden">'+Craft.t("image-resizer","Close")+"</div>").appendTo(this.$buttons),this.$cancelBtn=$('<div class="btn cancel">'+Craft.t("image-resizer","Cancel")+"</div>").appendTo(this.$buttons),this.$saveBtn=$('<div class="btn submit">'+Craft.t("image-resizer","Resize")+"</div>").appendTo(this.$buttons),this.$body=r,this.addListener(this.$closeBtn,"activate","onFadeOut"),this.addListener(this.$cancelBtn,"activate","onFadeOut"),this.addListener(this.$saveBtn,"activate","saveSettings")},onFadeOut:function(){this.hide()},saveSettings:function(){var e=[],t=this;this.$selectedItems.length&&this.$selectedItems.each((function(t,s){e[t]=$(s).data("id")})),this.$footerSpinner.removeClass("hidden");var s=this.$body.find("#settings-imageWidth").val(),i=this.$body.find("#settings-imageHeight").val(),a=this.generateId();if(this.settings.bulkResize)var n={taskId:a,bulkResize:this.settings.bulkResize,assetFolderId:this.settings.assetFolderId,imageWidth:s,imageHeight:i};else var n={taskId:a,assetIds:e,imageWidth:s,imageHeight:i};Craft.sendActionRequest("POST","image-resizer/base/resize-element-action",{data:n}),new Craft.ImageResizer.ResizeTaskProgress(this,a,(function(){t.$footerSpinner.addClass("hidden"),t.$closeBtn.removeClass("hidden"),t.$cancelBtn.addClass("hidden"),t.$saveBtn.addClass("hidden"),setTimeout($.proxy((function(){Craft.elementIndex&&Craft.elementIndex.updateElements()})),1e3)}))},generateId:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=0;s<5;s++)e+=t.charAt(Math.floor(62*Math.random()));return e}}),Craft.ImageResizer.ResizeTaskProgress=Garnish.Base.extend({modal:null,taskId:null,tasksById:null,completedTasks:null,updateTasksTimeout:null,completed:!1,callback:null,init:function(e,t,s){this.modal=e,this.taskId=t,this.callback=s,this.tasksById={},this.completedTasks=[],setTimeout($.proxy((function(){Craft.sendActionRequest("POST","queue/run")}),this),500),setTimeout($.proxy((function(){this.updateTasks()}),this),1500)},updateTasks:function(){this.completed=!1,Craft.sendActionRequest("POST","queue/get-job-info?dontExtendSession=1").then((e=>{console.log(e),this.showTaskInfo(e.data.jobs[0])}))},showTaskInfo:function(e){var t=[],s;e?t.push(e.id):(new Craft.ImageResizer.ResizeTaskProgress.Task(this.modal,this.taskId,e).complete(),this.completed=!0,this.callback());for(var i in this.tasksById)Craft.inArray(i,t)||(this.tasksById[i].complete(),this.completedTasks.push(this.tasksById[i]),delete this.tasksById[i]);if(e){var a=!1,n=!1;a||1!=e.status&&2!=e.status?n||4!=e.status||(n=!0):a=!0,this.tasksById[e.id]?this.tasksById[e.id].updateStatus(e):this.tasksById[e.id]=new Craft.ImageResizer.ResizeTaskProgress.Task(this.modal,this.taskId,e),a?this.updateTasksTimeout=setTimeout($.proxy(this,"updateTasks"),500):(this.completed=!0,this.callback())}else this.completed=!0,this.callback()}}),Craft.ImageResizer.ResizeTaskProgress.Task=Garnish.Base.extend({taskId:null,modal:null,id:null,level:null,description:null,status:null,progress:null,$container:null,$statusContainer:null,$descriptionContainer:null,_progressBar:null,init:function(e,t,s){this.taskId=t,this.modal=e,s&&(this.id=s.id,this.level=s.level,this.description=s.description),this.$container=$('<div class="task"/>').appendTo(this.modal.$body.find(".modal-main")),this.$statusContainer=$('<div class="task-status"/>').appendTo(this.$container),this.$container.data("task",this),s&&this.updateStatus(s)},updateStatus:function(e){if(this.status!=e.status)switch(this.$statusContainer.empty(),this.status=e.status,this.status){case 1:this._progressBar=new Craft.ProgressBar(this.$statusContainer),this._progressBar.showProgressBar();break;case 2:this._progressBar=new Craft.ProgressBar(this.$statusContainer),this._progressBar.showProgressBar();break;case 4:$('<div class="error">'+Craft.t("image-resizer",'Processing failed. <a class="go" href="'+Craft.getUrl("image-resizer/logs")+'">View logs</a>')+"</div>").appendTo(this.$statusContainer);break}1!=this.status&&2!=this.status||this._progressBar.setProgressPercentage(e.progress/100)},complete:function(){var e={taskId:this.taskId};Craft.sendActionRequest("POST","image-resizer/base/get-task-summary",{data:e}).then((e=>{var t='<span class="success">'+Craft.t("image-resizer","Success")+": "+e.data.summary.success+', </span><span class="skipped">'+Craft.t("image-resizer","Skipped")+": "+e.data.summary.skipped+', </span><span class="error">'+Craft.t("image-resizer","Error")+": "+e.data.summary.error+' </span><a class="go" href="'+Craft.getUrl("image-resizer/logs")+'">'+Craft.t("image-resizer","View logs")+"</a>";this.$statusContainer.empty(),$("<div>"+t+"</div>").appendTo(this.$statusContainer)}))},destroy:function(){this.$container.remove(),this.base()}})}(jQuery);
//# sourceMappingURL=image-resizer.js.map